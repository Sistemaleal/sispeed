{% load static %}
<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <title>{% block title %}Sispeed{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'img/icon.ico' %}">
</head>

<body
    class="{% if user.is_authenticated and user.preferences.theme == 'light' %}theme-light{% else %}theme-dark{% endif %}">
    {% block body %}
    <div class="layout">
        {% if user.is_authenticated %}
        {% with company_link=user.company_link permissions=user.company_link.permissions %}
        <aside class="sidebar">
            <div class="sidebar-top">
                <a href="{% url 'dashboard' %}" class="sidebar-brand">
                    <img src="{% static 'img/icon.ico' %}" alt="Sispeed" class="sidebar-logo">
                    <div class="sidebar-brand-text">
                        <span class="brand-title">Sispeed</span>
                        <span class="brand-subtitle">Painel de gestão</span>
                    </div>
                </a>

                <nav class="sidebar-nav">
                    <!-- Início -->
                    <a href="{% url 'dashboard' %}"
                        class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                        <span class="nav-icon">
                            <svg viewBox="0 0 24 24" aria-hidden="true">
                                <path
                                    d="M4 10.5 12 4l8 6.5V20a1 1 0 0 1-1 1h-4.5a.5.5 0 0 1-.5-.5v-4.25a1.25 1.25 0 0 0-1.25-1.25h-1.5A1.25 1.25 0 0 0 9 15.25V19.5a.5.5 0 0 1-.5.5H4a1 1 0 0 1-1-1v-9z" />
                            </svg>
                        </span>
                        <span class="nav-label">Início</span>
                    </a>

                    <!-- Cadastros -->
                    <div class="nav-section">
                        <div class="nav-section-header">
                            <span class="nav-section-label">Cadastros</span>
                            <span class="nav-section-dot"></span>
                        </div>
                        <div class="nav-section-items">

                            {# Contatos #}
                            {% with has_access=permissions.can_manage_contacts %}
                            <a href="{% url 'contacts_list' %}" class="nav-link nav-sub
                                      {% if request.resolver_match.url_name|default:''|slice:':8' == 'contacts' %}active{% endif %}
                                      {% if not has_access and not company_link.is_owner %}nav-no-access{% endif %}">
                                <span class="nav-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path
                                            d="M5 5.75A2.75 2.75 0 0 1 7.75 3h8.5A2.75 2.75 0 0 1 19 5.75v12.5A2.75 2.75 0 0 1 16.25 21h-8.5A2.75 2.75 0 0 1 5 18.25zM9 8a2 2 0 1 0 4 0 2 2 0 0 0-4 0Zm4.5 5.25c0-.69-.56-1.25-1.25-1.25h-1.5A1.25 1.25 0 0 0 9.5 13.25v.25h4z" />
                                    </svg>
                                </span>
                                <span class="nav-label">Contatos</span>
                                {% if not has_access and not company_link.is_owner %}
                                <span class="nav-pill nav-pill-muted">sem acesso</span>
                                {% endif %}
                            </a>
                            {% endwith %}

                            {# Usuários #}
                            {% with has_access=permissions.can_manage_users %}
                            <a href="{% url 'users_list' %}" class="nav-link nav-sub
                                      {% if request.resolver_match.url_name|default:''|slice:':5' == 'users' %}active{% endif %}
                                      {% if not has_access and not company_link.is_owner %}nav-no-access{% endif %}">
                                <span class="nav-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path
                                            d="M9 12a3 3 0 1 0-3-3 3 3 0 0 0 3 3Zm6 0a2.5 2.5 0 1 0-2.5-2.5A2.5 2.5 0 0 0 15 12Zm-9.75 5.5A2.25 2.25 0 0 1 7.5 15h3a2.25 2.25 0 0 1 2.25 2.25V19H5.25A.75.75 0 0 1 4.5 18.25ZM14 17.25A3.25 3.25 0 0 1 17.25 14.5h.5A2.25 2.25 0 0 1 20 16.75V19h-6Z" />
                                    </svg>
                                </span>
                                <span class="nav-label">Usuários</span>
                                {% if not has_access and not company_link.is_owner %}
                                <span class="nav-pill nav-pill-muted">sem acesso</span>
                                {% endif %}
                            </a>
                            {% endwith %}

                            {# Produtos #}
                            {% with has_access=permissions.can_manage_products %}
                            <a href="{% url 'products_list' %}" class="nav-link nav-sub
                                      {% if request.resolver_match.url_name|default:''|slice:':8' == 'products' %}active{% endif %}
                                      {% if not has_access and not company_link.is_owner %}nav-no-access{% endif %}">
                                <span class="nav-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path
                                            d="m11.2 3.3-6 2.4A1.5 1.5 0 0 0 4 7.1v9.8a1.5 1.5 0 0 0 .9 1.4l6 2.4a1.5 1.5 0 0 0 1.1 0l6-2.4a1.5 1.5 0 0 0 .9-1.4V7.1a1.5 1.5 0 0 0-.9-1.4l-6-2.4a1.5 1.5 0 0 0-1.1 0ZM12 5l4.7 1.9L12 8.8 7.3 6.9Z" />
                                    </svg>
                                </span>
                                <span class="nav-label">Produtos</span>
                                {% if not has_access and not company_link.is_owner %}
                                <span class="nav-pill nav-pill-muted">sem acesso</span>
                                {% endif %}
                            </a>
                            {% endwith %}

                            {# Setores #}
                            {% with has_access=permissions.can_manage_sectors %}
                            <a href="{% url 'sectors_list' %}" class="nav-link nav-sub
                                      {% if request.resolver_match.url_name|default:''|slice:':7' == 'sectors' %}active{% endif %}
                                      {% if not has_access and not company_link.is_owner %}nav-no-access{% endif %}">
                                <span class="nav-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M4 9.25 12 5l8 4.25-8 4.25Z" />
                                        <path d="m4 13.5 8 4.25 8-4.25" opacity=".6" />
                                    </svg>
                                </span>
                                <span class="nav-label">Setores</span>
                                {% if not has_access and not company_link.is_owner %}
                                <span class="nav-pill nav-pill-muted">sem acesso</span>
                                {% endif %}
                            </a>
                            {% endwith %}

                        </div>
                    </div>

                    <!-- Operações -->
                    <div class="nav-section">
                        <div class="nav-section-header">
                            <span class="nav-section-label">Operações</span>
                            <span class="nav-section-dot dot-secondary"></span>
                        </div>
                        <div class="nav-section-items">
                            <a href="#" class="nav-link nav-disabled">
                                <span class="nav-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path
                                            d="M7 4.5A2.5 2.5 0 0 1 9.5 2h5.38a1.5 1.5 0 0 1 1.06.44l3.62 3.62A1.5 1.5 0 0 1 20 7.12V17.5A2.5 2.5 0 0 1 17.5 20H9.5A2.5 2.5 0 0 1 7 17.5Z" />
                                    </svg>
                                </span>
                                <span class="nav-label">Propostas</span>
                                <span class="nav-pill">em breve</span>
                            </a>
                            <a href="#" class="nav-link nav-disabled">
                                <span class="nav-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path
                                            d="M3.75 5A1.75 1.75 0 0 1 5.5 3.25h4.75A1.75 1.75 0 0 1 12 5v13a.75.75 0 0 1-1.14.62l-3.3-2.2a.75.75 0 0 0-.84 0l-3.3 2.2A.75.75 0 0 1 2.25 18Z" />
                                    </svg>
                                </span>
                                <span class="nav-label">Produção</span>
                                <span class="nav-pill">em breve</span>
                            </a>
                            <a href="#" class="nav-link nav-disabled">
                                <span class="nav-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path
                                            d="M5 19V9.5a1 1 0 0 1 1-1h1.5a1 1 0 0 1 1 1V19Zm5 0v-7a1 1 0 0 1 1-1h1.5a1 1 0 0 1 1 1V19Zm5 0v-10a1 1 0 0 1 1-1H18a1 1 0 0 1 1 1V19Z" />
                                    </svg>
                                </span>
                                <span class="nav-label">Dashboard</span>
                                <span class="nav-pill">em breve</span>
                            </a>
                            <a href="#" class="nav-link nav-disabled">
                                <span class="nav-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path
                                            d="M4 6.75A2.75 2.75 0 0 1 6.75 4h10.5A2.75 2.75 0 0 1 20 6.75v10.5A2.75 2.75 0 0 1 17.25 20H6.75A2.75 2.75 0 0 1 4 17.25Zm2 0A.75.75 0 0 0 5.25 7.5h13.5a.75.75 0 0 0 0-1.5Z" />
                                    </svg>
                                </span>
                                <span class="nav-label">Financeiro</span>
                                <span class="nav-pill">em breve</span>
                            </a>
                        </div>
                    </div>

                    <!-- Ajustes + Suporte -->
                    <div class="nav-section">
                        <div class="nav-section-header">
                            <span class="nav-section-label">Ajustes</span>
                            <span class="nav-section-dot"></span>
                        </div>
                        <div class="nav-section-items">
                            <a href="{% url 'settings' %}" class="nav-link">
                                <span class="nav-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path
                                            d="M10.5 4.5a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1V6h1.25a2.75 2.75 0 0 1 2.75 2.75V10h-1.5V8.75a1.25 1.25 0 0 0-1.25-1.25H7.25A1.25 1.25 0 0 0 6 8.75V10H4.5V8.75A2.75 2.75 0 0 1 7.25 6H10.5Z" />
                                        <path d="M5 11.5h14V17a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 5 17Z" />
                                    </svg>
                                </span>
                                <span class="nav-label">Ajustes</span>
                            </a>
                            <a href="#" class="nav-link">
                                <span class="nav-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path
                                            d="M6.25 4A2.25 2.25 0 0 0 4 6.25v7.5A2.25 2.25 0 0 0 6.25 16H9.5l3.25 3.25c.7.7 1.9.2 1.9-.79V16h3.1A2.25 2.25 0 0 0 20 13.75v-7.5A2.25 2.25 0 0 0 17.75 4Z" />
                                    </svg>
                                </span>
                                <span class="nav-label">Suporte</span>
                            </a>
                        </div>
                    </div>
                </nav>
            </div>

            <div class="sidebar-bottom">
                <div class="sidebar-user">
                    <div class="avatar-circle">
                        <span>{{ user.first_name|default:user.username|first|upper }}</span>
                    </div>
                    <div class="sidebar-user-info">
                        <span class="user-name">
                            {{ user.first_name|default:user.username }}
                            {% if company_link.is_owner %}
                            <span class="user-badge">Dono</span>
                            {% endif %}
                        </span>
                        <span class="user-company">
                            {{ company_link.company.name }}
                        </span>
                    </div>
                </div>
                <a href="{% url 'logout' %}" class="nav-link nav-logout">
                    <span class="nav-icon">
                        <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path
                                d="M10 5a1 1 0 0 1 1-1h7.25A1.75 1.75 0 0 1 20 5.75v12.5A1.75 1.75 0 0 1 18.25 20H11a1 1 0 0 1 0-2h7V6h-7a1 1 0 0 1-1-1Z" />
                            <path
                                d="M5.7 8.3a1 1 0 0 1 1.4 0L9.4 10.6a1 1 0 0 1 0 1.4L7.1 14.3A1 1 0 1 1 5.7 12.9L6.59 12H3a1 1 0 0 1 0-2h3.59L5.7 9.1a1 1 0 0 1 0-1.4Z" />
                        </svg>
                    </span>
                    <span class="nav-label">Sair</span>
                </a>
            </div>
        </aside>
        {% endwith %}
        {% endif %}

        <main class="content">
            {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="message {{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
            {% endif %}

            {% block content %}{% endblock %}
        </main>
    </div>
    {% endblock %}
</body>

</html>